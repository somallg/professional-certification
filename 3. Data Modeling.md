# 3. Data Modeling
* Data in MongoDB has a *flexible schema*
* MongoDB's collections do not enforce document structure
* The documents in a collection share a similar structure

## 3.1 Embedding
* Storing related data in a single document
* Those *denormalized* data models allow application to retrieve and manipulate related data in a single database operation
* Pros
    * Better performance, able to retrieve related data in a single database operation
    * Atomicity of write operations
* Cons:
    * Update can increase a document's size
    * Share document duplicate
* Use when:
    * Have "contains" relationships between entities
    * Have one-to-many relationships. The "many" or child documents always appear with or are viewed in the context of the "one" or parent document

![Embedded Data](images/data-model-denormalized.png)

## 3.2 References
* Store the relationships between data by including links or *references* from one document to another
* Pros:
    * More flexibility
    * Can use share document
* Cons:
    * Client-side must follow-up queries to resolve the references
    * More round trips to the server
* Use when:
    * when embedding result duplication of data
    * to represent more complex many-to-many- relationships
    * to model large hierarchical data sets

![References](images/data-model-normalized.png)

## 3.3 Document Growth (MMAPv1)

## 3.4 Modeling one-to-one, one-to-many, many-to-many relationships

## 3.5 Modeling for atomic operations
* Write operations are atomic on the level of a single document
* Embedding the fields within the same document ensures that the fields can be updated atomically
* Example:
```
{
    _id: 123456789,
    title: "MongoDB: The Definitive Guide",
    author: [ "Kristina Chodorow", "Mike Dirolf" ],
    published_date: ISODate("2010-09-24"),
    pages: 216,
    language: "English",
    publisher_id: "oreilly",
    available: 3,
    checkout: [ { by: "joe", date: ISODate("2012-10-15") } ]
}
```

* Update
```
db.books.update (
   { _id: 123456789, available: { $gt: 0 } },
   {
     $inc: { available: -1 },
     $push: { checkout: { by: "abc", date: new Date() } }
   }
)
```

## 3.6 Modeling tree structures
